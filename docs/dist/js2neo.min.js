!function(){function d(){}function p(n){var o="";function u(n){var t,e;if(null===n)o+="À";else if("string"==typeof n)(e=n.length)<16?o+=String.fromCharCode(128+e)+n:e<256?o+="Ð"+String.fromCharCode(e)+n:e<65536&&(o+="Ñ"+String.fromCharCode(e>>8)+String.fromCharCode(255&e)+n);else if(n instanceof v)for(o+=String.fromCharCode(176+n.fields.length,n.tag),t=0;t<n.fields.length;t++)u(n.fields[t]);else{var r=Object.getOwnPropertyNames(n);for(o+=String.fromCharCode(160+r.length),t=0;t<r.length;t++)u(r[t]),u(n[r[t]])}}for(var t=0;t<n.length;t++)u(n[t]);return o}function w(o){var n=[],u=0;function t(n){var t=u;return u+=n,t}function e(n){for(var t="",e=u+n;u<e;u++)t+=String.fromCharCode(o.getUint8(u));return t}function r(n){for(var t=[],e=0;e<n;e++)t.push(f());return t}function i(n){for(var t={},e=0;e<n;e++){t[f()]=f()}return t}function f(){var n=o.getUint8(u++);return n<128?n:n<144?e(n-128):n<160?r(n-144):n<176?i(n-160):n<192?function(n){for(var t=o.getUint8(u++),e=[],r=0;r<n;r++)e.push(f());return new v(t,e)}(n-176):n<193?null:n<194?o.getFloat64(t(8)):n<196?!!(1&n):n<200?void 0:n<201?o.getInt8(t(1)):n<202?o.getInt16(t(2)):n<203?o.getInt32(t(4)):n<204?[o.getUint32(t(4)),o.getUint32(t(4))]:n<208?void 0:n<209?e(o.getUint8(u++)):n<210?e(o.getUint16(t(2))):n<211?e(o.getUint32(t(4))):n<212?void 0:n<213?r(o.getUint8(u++)):n<214?r(o.getUint16(t(2))):n<215?r(o.getUint32(t(4))):n<216?void 0:n<217?i(o.getUint8(u++)):n<218?i(o.getUint16(t(2))):n<219?i(o.getUint32(t(4))):n<240?void 0:n-256}for(;u<o.byteLength;)n.push(f());return n}function v(n,t){this.tag=n,this.fields=t||[]}function C(n){for(var t=new Uint8Array(n.length),e=0;e<n.length;e++)t[e]=n.charCodeAt(e);return t.buffer}function U(n,t){this.message=n,this.handler=t}function t(n){n=n||{};var e={userAgent:"js2neo/1.0.0-alpha.0",url:("https:"===document.location.protocol?"wss":"ws")+"://"+(n.host||"localhost")+":"+(n.port||7687),user:n.user||"neo4j"},t={scheme:"basic",principal:e.user,credentials:n.password||"password"},o=new Uint8Array(2),u={},i=[],f=[],r=n.onConnect||d;function a(){u.rawInputBuffer="",u.chunkInputBuffer=[],u.ready=!1,u.socket=new WebSocket(e.url),u.socket.binaryType="arraybuffer",u.socket.onmessage=g,u.socket.onerror=console.log,u.socket.onclose=console.log,u.socket.onopen=function(){u.socket.send(new Uint8Array([96,96,176,23,0,0,0,2,0,0,0,1,0,0,0,0,0,0,0,0]))},i.push(new U(new v(1,[e.userAgent,t]),{112:function(){u.ready=!0},127:s}))}function s(n){u.socket.close(1002,n.code+": "+n.message),a()}function c(){function e(n){u.socket.send(n)}function n(n,t){o[0]=n,o[1]=t,e(o)}for(;0<i.length;){var t=i.shift(),r=p([t.message]);for(f.push(t.handler);32767<r.length;)n(127,255),e(C(r.substr(0,32767))),r=r.substr(32767);n(r.length>>8,255&r.length),e(C(r)),n(0,0)}}function g(n){var t=new DataView(n.data);e.protocolVersion=t.getInt32(0,!1),r(e),u.socket.onmessage=l,c()}function h(n){var t,e,r;""===n?(t=C(u.chunkInputBuffer.join()),e=w(new DataView(t))[0],r=113===e.tag?f[0]:f.shift(),127===e.tag&&i.push(new U(new v(14),{127:s})),r&&(r[e.tag]||d)(e.fields[0]),u.chunkInputBuffer=[]):u.chunkInputBuffer.push(n)}function l(n){u.rawInputBuffer+=function(n){for(var t=new DataView(n),e="",r=0;r<t.byteLength;r++)e+=String.fromCharCode(t.getUint8(r));return e}(n.data);for(var t=!0;t;){var e=2+(256*u.rawInputBuffer.charCodeAt(0)+u.rawInputBuffer.charCodeAt(1));u.rawInputBuffer.length>=e?(h(u.rawInputBuffer.slice(2,e)),u.rawInputBuffer=u.rawInputBuffer.substr(e)):t=!1}}this.run=function(n){var t=n.cypher;0<t.length&&(i.push(new U(new v(16,[t,n.parameters||{}]),{112:n.onHeader||d,127:n.onFailure||d})),i.push(new U(new v(63),{112:n.onFooter||d,113:n.onRecord||d,127:n.onFailure||d}))),u.ready&&c()},a()}window.js2neo={bolt:function(n){return new t(n)}}}();