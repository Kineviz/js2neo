// js2neo 1 © 2018 Nigel Small
// Licensed under the Apache License, Version 2.0
!function(n){var t="days",e="id",o="nanoseconds",i="properties",r="seconds",m=(String.fromCharCode,DataView),h=Math.min,l=n.js2neo={version:"1",Node:function(n){s.call(this,n,e,"labels",i)},Relationship:function(n){s.call(this,n,e,"start","end","type",i)},Path:function(n){var t,e,o,i,r=n[0],s=n[1],a=n[2],u=r[0],c=[u],f=l.Relationship;for(e=0;e<a.length;e+=2)o=a[e],t=r[a[2*e+1]],0<o?(i=s[o-1],c.push(new f([i.id,u.id,t.id,i.type,i.properties]))):(i=s[s.length+o],c.push(new f([i.id,t.id,u.id,i.type,i.properties]))),c.push(t),u=t;this.entities=c},Point:function(n){s.call(this,n,"srid","x","y")},Date:function(n){s.call(this,n,t)},Time:function(n){this.seconds=n[0]/1e9,this.tz=n[1]},LocalTime:function(n){this.seconds=n[0]/1e9},DateTime:function(n){s.call(this,n,r,o,"tz")},LocalDateTime:function(n){s.call(this,n,r,o)},Duration:function(n){s.call(this,n,"months",t,r,o)},open:function(n){return new a(n)}};function p(n){return new ArrayBuffer(n||0)}function y(n){return new Uint8Array(n)}function D(){for(var n=arguments,t=n.length,e=0,o=0;o<t;o++)e+=n[o].byteLength;var i=p(e),r=y(i),s=0;for(o=0;o<t;o++)r.set(y(n[o]),s),s+=n[o].byteLength;return i}function s(n){for(var t=0;t<n.length;t++)this[arguments[t+1]]=n[t]}var w={68:l.Date,69:l.Duration,70:l.DateTime,78:l.Node,80:l.Path,82:l.Relationship,84:l.Time,88:l.Point,100:l.LocalDateTime,102:l.DateTime,114:function(n){s.call(this,n,e,"type",i)},116:l.LocalTime};function a(n){var e={secure:(n=n||{}).secure||"https:"===document.location.protocol,user:n.user,host:n.host||"localhost",port:n.port||7687,userAgent:n.userAgent||"js2neo/"+l.version},t={scheme:"basic",principal:e.user,credentials:n.password},s={inData:p(),inMessageData:p(),ready:!1,socket:new WebSocket((e.secure?"wss":"ws")+"://"+e.host+":"+e.port)},g=s.socket,o=n.onHandshake,i=n.onInit,r=n.onOpen,d=[[1,[e.userAgent,t],{112:function(){i&&i(e),s.ready=!0},127:n.onInitFailure}]],v=[];function c(n){g.send(n)}function a(){for(;0<d.length;){var n=d.shift(),r=[176+n[1].length,n[0]],t=0;function s(n){var t=y(8);new m(t.buffer).setFloat64(0,n,!1),r.push(193),t.forEach(function(n){r.push(n)})}function a(n,t,e,o){return(n=h(n,2147483647))<16?r.push(t+n):n<65536?r.push(e,n>>8,255&n):r.push(o,n>>24,n>>16&255,n>>8&255,255&n),n}function u(n){var t,e,o;if(Array.isArray(n))for(t=a(n.length,144,213,214),e=0;e<t;e++)u(n[e]);else{var i=typeof n;if("boolean"===i)r.push(n?179:178);else if("number"===i)n%1==0?-16<=(o=n)&&o<128?r.push((256+o)%256):-32768<=o&&o<32768?r.push(201,o>>8,255&o):-2147483648<=o&&o<2147483648?r.push(202,o>>24,o>>16&255,o>>8&255,255&o):s(o):s(n);else if("string"===i)for(t=a(n.length,128,209,210),e=0;e<t;e++)r.push(n.charCodeAt(e));else"object"===i?function(n){for(var t,e=Object.getOwnPropertyNames(n),o=a(e.length,160,217,218),i=0;i<o;i++)u(t=e[i]),u(n[t])}(n):r.push(192)}}for(n[1].forEach(u),v.push(n[2]);r=r.slice(t),c(y([(t=h(r.length,32767))>>8,255&t].concat(r.slice(0,t)))),r.length;);}}function u(n){var o=new m(n),r=0;function s(){return o.getUint8(r++)}function i(){return r+=2,o.getUint16(r-2,!1)}function a(){return r+=4,o.getUint16(r-4,!1)}function u(n){for(var t,e,o="",i=r+n;r<i;)(t=s())<128?o+=String.fromCharCode(t):192==(224&t)?r+1<=i?(e=(31&t)<<6|63&s(),o+=String.fromCharCode(e)):o+="�":224==(240&t)?r+2<=i?(e=(15&t)<<12|(63&s())<<6|63&s(),o+=String.fromCharCode(e)):o+="�":240==(248&t)&&r+3<=i?(e=(7&t)<<18|(63&s())<<12|(63&s())<<6|63&s(),e-=65536,o+=String.fromCharCode(55296+(e>>10),e%1024+56320)):o+="�";return o}function c(n){for(var t=[];n--;)t.push(e());return t}function f(n){for(var t={};n--;){t[e()]=e()}return t}function h(n){for(var t=[s()];n--;)t.push(e());return t}function e(){var n,t,e=s();return e<128?e:e<144?u(e-128):e<160?c(e-144):e<176?f(e-160):e<192?(n=h(e-176),(t=w[n[0]])?new t(n.slice(1)):n):e<193?null:e<194?(r+=8,o.getFloat64(r-8,!1)):e<196?!!(1&e):e<200?void 0:e<201?o.getInt8(r++):e<202?(r+=2,o.getInt16(r-2,!1)):e<203?(r+=4,o.getInt32(r-4,!1)):e<204?function(){var n=o.getUint32(r,!1).toString(16),t=o.getUint32(r+4,!1).toString(16);for(r+=8;n.length<8;)n="0"+n;for(;t.length<8;)t="0"+t;return parseInt("0x"+n+t,16)}():e<208?void 0:e<209?u(s()):e<210?u(i()):e<211?u(a()):e<212?void 0:e<213?c(s()):e<214?c(i()):e<215?c(a()):e<216?void 0:e<217?f(s()):e<218?f(i()):e<219?f(a()):e<240?void 0:e-256}var t=h(s()-176),l=t[0],p=(113===l?v[0]:v.shift())[l];127===l&&d.push([14,[],{127:function(n){g.close(4002,n.code+": "+n.message)}}]),p&&p(t[1])}function f(n){for(var t,e,o,i=s.inData=D(s.inData,n.data),r=2<=i.byteLength?1:0;r;)e=2+(t=(o=y(i))[0]<<8|o[1]),i.byteLength>=e?(t?s.inMessageData=D(s.inMessageData,i.slice(2,e)):(u(s.inMessageData),s.inMessageData=p()),i=s.inData=s.inData.slice(e)):r=0}g.binaryType="arraybuffer",g.onmessage=function(n){var t=new m(n.data);e.protocolVersion=t.getInt32(0,!1),o&&o(e),g.onmessage=f,a()},g.onclose=n.onClose,g.onopen=function(){r&&r(e),c(y([96,96,176,23,0,0,0,2,0,0,0,1,0,0,0,0,0,0,0,0]))},this.run=function(n,t,e){e=e||{},n&&(d.push([16,[n,t||{}],{112:e.onHeader,127:e.onFailure}]),d.push([63,[],{112:e.onFooter,113:e.onRecord,127:e.onFailure}])),s.ready&&a()},this.close=function(){g.close(1e3)}}console.log("js2neo "+l.version)}("object"==typeof window?window:global);
