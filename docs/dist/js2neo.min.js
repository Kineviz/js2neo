// js2neo 1β © 2018 Nigel Small
// Licensed under the Apache License, Version 2.0
!function(n){var t="days",e="id",o="nanoseconds",i="properties",r="seconds",w=String.fromCharCode,y=DataView,f=Uint8Array,h=Math.min,p=n.js2neo={version:"1β",Node:function(n){s.call(this,n,e,"labels",i)},Relationship:function(n){s.call(this,n,e,"start","end","type",i)},Path:function(n){var t,e,o,i,r=n[0],s=n[1],a=n[2],u=r[0],c=[u],l=p.Relationship;for(e=0;e<a.length;e+=2)o=a[e],t=r[a[2*e+1]],0<o?(i=s[o-1],c.push(new l([i.id,u.id,t.id,i.type,i.properties]))):(i=s[s.length+o],c.push(new l([i.id,t.id,u.id,i.type,i.properties]))),c.push(t),u=t;this.entities=c},Point:function(n){s.call(this,n,"srid","x","y")},Date:function(n){s.call(this,n,t)},Time:function(n){this.seconds=n[0]/1e9,this.tz=n[1]},LocalTime:function(n){this.seconds=n[0]/1e9},DateTime:function(n){s.call(this,n,r,o,"tz")},LocalDateTime:function(n){s.call(this,n,r,o)},Duration:function(n){s.call(this,n,"months",t,r,o)},open:function(n){return new a(n)}};function s(n){for(var t=0;t<n.length;t++)this[arguments[t+1]]=n[t]}function m(n){for(var t=new f(n.length),e=0;e<n.length;e++)t[e]=n.charCodeAt(e);return t.buffer}var b={68:p.Date,69:p.Duration,70:p.DateTime,78:p.Node,80:p.Path,82:p.Relationship,84:p.Time,88:p.Point,100:p.LocalDateTime,102:p.DateTime,114:function(n){s.call(this,n,e,"type",i)},116:p.LocalTime};function a(n){var e={secure:(n=n||{}).secure||"https:"===document.location.protocol,user:n.user,host:n.host||"localhost",port:n.port||7687,userAgent:n.userAgent||"js2neo/"+p.version},t={scheme:"basic",principal:e.user,credentials:n.password},s={inData:"",inChunks:[],ready:!1,socket:new WebSocket((e.secure?"wss":"ws")+"://"+e.host+":"+e.port)},d=s.socket,o=n.onHandshake,i=n.onInit,r=n.onOpen,g=[[1,[e.userAgent,t],{112:function(){i&&i(e),s.ready=!0},127:n.onInitFailure}]],v=[];function l(n){d.send(n)}function a(){for(;0<g.length;){var n=g.shift(),r=w(176+n[1].length,n[0]),t=0;function s(n){return w(n>>24)+w(n>>16&255)+w(n>>8&255)+w(255&n)}function a(n){var t=new f(8);new y(t.buffer).setFloat64(0,n,!1),r+="Á"+w.apply(null,t)}function u(n,t,e,o){return n=h(n,2147483647),r+=n<16?w(t+n):n<65536?e+w(n>>8)+w(255&n):o+s(n),n}function c(n){var t,e,o;if(Array.isArray(n))for(t=u(n.length,144,"Õ","Ö"),e=0;e<t;e++)c(n[e]);else{var i=typeof n;"boolean"===i?r+=n?"Ã":"Â":"number"===i?n%1==0?-16<=(o=n)&&o<128?r+=w((256+o)%256):-32768<=o&&o<32768?r+="É"+w(o>>8)+w(255&o):-2147483648<=o&&o<2147483648?r+="Ê"+s(o):a(o):a(n):"string"===i?(t=u(n.length,128,"Ñ","Ò"),r+=n.substr(0,t)):"object"===i?function(n){for(var t,e=Object.getOwnPropertyNames(n),o=u(e.length,160,"Ù","Ú"),i=0;i<o;i++)c(t=e[i]),c(n[t])}(n):r+="À"}}for(n[1].forEach(c),v.push(n[2]);r=r.substr(t),t=h(r.length,32767),l(m(w(t>>8,255&t)+r.substr(0,t))),r;);}}function u(n){var o=new y(n),i=0;function r(){return o.getUint8(i++)}function s(){return i+=2,o.getUint16(i-2,!1)}function a(){return i+=4,o.getUint16(i-4,!1)}function u(n){for(var t="",e=i+n;i<e;)t+=w(r());return t}function c(n){for(var t=[];n--;)t.push(e());return t}function l(n){for(var t={};n--;){t[e()]=e()}return t}function f(n){for(var t=[r()];n--;)t.push(e());return t}function e(){var n,t,e=r();return e<128?e:e<144?u(e-128):e<160?c(e-144):e<176?l(e-160):e<192?(n=f(e-176),(t=b[n[0]])?new t(n.slice(1)):n):e<193?null:e<194?(i+=8,o.getFloat64(i-8,!1)):e<196?!!(1&e):e<200?void 0:e<201?o.getInt8(i++):e<202?(i+=2,o.getInt16(i-2,!1)):e<203?(i+=4,o.getInt32(i-4,!1)):e<204?function(){var n=o.getUint32(i,!1).toString(16),t=o.getUint32(i+4,!1).toString(16);for(i+=8;n.length<8;)n="0"+n;for(;t.length<8;)t="0"+t;return parseInt("0x"+n+t,16)}():e<208?void 0:e<209?u(r()):e<210?u(s()):e<211?u(a()):e<212?void 0:e<213?c(r()):e<214?c(s()):e<215?c(a()):e<216?void 0:e<217?l(r()):e<218?l(s()):e<219?l(a()):e<240?void 0:e-256}var t=f(r()-176),h=t[0],p=(113===h?v[0]:v.shift())[h];127===h&&g.push([14,[],{127:function(n){d.close(4002,n.code+": "+n.message)}}]),p&&p(t[1])}function c(n){for(var t,e,o=1,i=s.inData+=w.apply(null,new f(n.data)),r=s.inChunks;o;)t=2+(i.charCodeAt(0)<<8|i.charCodeAt(1)),i.length>=t?((e=i.slice(2,t))?r.push(e):(u(m(r.join())),r=s.inChunks=[]),i=s.inData=s.inData.substr(t)):o=0}d.binaryType="arraybuffer",d.onmessage=function(n){var t=new y(n.data);e.protocolVersion=t.getInt32(0,!1),o&&o(e),d.onmessage=c,a()},d.onclose=n.onClose,d.onopen=function(){r&&r(e),l(new f([96,96,176,23,0,0,0,2,0,0,0,1,0,0,0,0,0,0,0,0]))},this.run=function(n,t,e){e=e||{},n&&(g.push([16,[n,t||{}],{112:e.onHeader,127:e.onFailure}]),g.push([63,[],{112:e.onFooter,113:e.onRecord,127:e.onFailure}])),s.ready&&a()},this.close=function(){d.close(1e3)}}console.log("js2neo "+p.version)}("object"==typeof window?window:global);
